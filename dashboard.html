<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Dashboard Hover Description</title>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>QU·∫¢N L√ù S·∫¢N PH·∫®M</h1>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="üîç T√¨m ki·∫øm..." oninput="handleSearch()">
    </div>

    <table>
        <thead>
            <tr>
                <th width="50">ID</th>
                <th width="100">H√¨nh ·∫£nh</th>
                <th class="sortable" onclick="handleSort('title')">T√™n s·∫£n ph·∫©m <span id="icon-title" class="sort-icon">‚áÖ</span></th>
                <th class="sortable" onclick="handleSort('price')">Gi√° <span id="icon-price" class="sort-icon">‚áÖ</span></th>
                
                <th width="80">Chi ti·∫øt</th> 
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <div class="pagination-container" id="pagination">
        <button class="btn-page" onclick="changePage(-1)" id="btn-prev">‚ùÆ Tr∆∞·ªõc</button>
        <span id="page-info">Trang 1</span>
        <button class="btn-page" onclick="changePage(1)" id="btn-next">Sau ‚ùØ</button>
    </div>

    <script>
        // ... (Gi·ªØ nguy√™n c√°c bi·∫øn v√† h√†m loadData, handleSort, handleSearch c≈©) ...
        const API_URL = 'https://api.escuelajs.co/api/v1/products';
        const FALLBACK_IMAGE = 'https://placehold.co/100x100?text=No+Img';
        
        let allProducts = [];      
        let filteredProducts = []; 
        let currentPage = 1;       
        const rowsPerPage = 10;    
        let currentSort = { column: null, direction: 'default' };

        // --- Copy l·∫°i to√†n b·ªô logic c≈©, CH·ªà S·ª¨A H√ÄM renderTable ---

        async function loadData() {
            /* Gi·ªØ nguy√™n logic c≈© */
            const tableBody = document.getElementById('table-body');
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                allProducts = data;
                filteredProducts = [...data];
                updateView();
            } catch (error) { console.error(error); }
        }

        function updateView() {
            /* Gi·ªØ nguy√™n logic c≈© */
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const pageData = filteredProducts.slice(startIndex, endIndex);
            renderTable(pageData);
            renderPaginationControls();
        }

        // --- ƒê√ÇY L√Ä H√ÄM C·∫¶N S·ª¨A ---
        function renderTable(productList) {
            const tableBody = document.getElementById('table-body');
            
            if (productList.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu!</td></tr>';
                return;
            }

            tableBody.innerHTML = '';

            productList.forEach(product => {
                // Logic x·ª≠ l√Ω ·∫£nh (Gi·ªØ nguy√™n)
                let imgUrl = FALLBACK_IMAGE;
                if (product.images?.length > 0) {
                    let rawImg = product.images[0];
                    if (typeof rawImg === 'string' && rawImg.startsWith('["')) {
                        try { imgUrl = JSON.parse(rawImg)[0] || FALLBACK_IMAGE; } catch (e) { imgUrl = rawImg.replace(/[\[\]"]/g, ''); }
                    } else { imgUrl = rawImg.replace(/[\[\]"]/g, ''); }
                }

                const row = `
                    <tr>
                        <td>${product.id}</td>
                        <td>
                            <img src="${imgUrl}" class="product-img" alt="img" 
                                 onerror="this.onerror=null; this.src='${FALLBACK_IMAGE}';">
                        </td>
                        <td><strong>${product.title}</strong></td>
                        <td class="price-tag">$${product.price}</td>
                        
                        <td align="center">
                            <div class="tooltip-container">
                                <span class="tooltip-trigger">üìú</span>
                                
                                <div class="tooltip-content">
                                    <strong>M√¥ t·∫£ chi ti·∫øt:</strong><br>
                                    ${product.description}
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        /* ... Gi·ªØ nguy√™n c√°c h√†m handleSort, handleSearch, pagination c√≤n l·∫°i ... */
        function handleSort(column) { /* Logic c≈© */ 
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }
            if (column === 'price') {
                filteredProducts.sort((a, b) => currentSort.direction === 'asc' ? a.price - b.price : b.price - a.price);
            } else if (column === 'title') {
                filteredProducts.sort((a, b) => currentSort.direction === 'asc' ? a.title.localeCompare(b.title) : b.title.localeCompare(a.title));
            }
            currentPage = 1;
            updateSortIcons(column, currentSort.direction);
            updateView();
        }
        
        function updateSortIcons(column, direction) { /* Logic c≈© */
             document.querySelectorAll('.sort-icon').forEach(el => el.innerText = '‚áÖ');
             document.querySelectorAll('.sortable').forEach(th => th.classList.remove('active'));
             const icon = document.getElementById('icon-' + column);
             if(icon) {
                 icon.innerText = direction === 'asc' ? '‚ñ≤' : '‚ñº';
                 icon.parentElement.classList.add('active');
             }
        }

        function handleSearch() { /* Logic c≈© */
             const keyword = document.getElementById('search-input').value.toLowerCase();
             filteredProducts = allProducts.filter(p => p.title.toLowerCase().includes(keyword));
             currentPage = 1;
             updateView();
        }

        function changePage(d) { currentPage += d; updateView(); }
        function renderPaginationControls() { /* Logic c≈© */
            const total = Math.ceil(filteredProducts.length / rowsPerPage) || 1;
            document.getElementById('page-info').innerText = `Trang ${currentPage} / ${total}`;
            document.getElementById('btn-prev').disabled = currentPage === 1;
            document.getElementById('btn-next').disabled = currentPage === total;
        }

        loadData();
    </script>
</body>
</html>